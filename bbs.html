<!DOCTYPE html>
<html>
<header>
    <title>The billion birth second</title>
    <script>
        function getParams() {
            var idx = document.URL.indexOf('?');
            var params = new Array();
            if (idx != -1) {
                var pairs = document.URL.substring(idx+1, document.URL.length).split('&');
                for (var i=0; i<pairs.length; i++) {
                    nameVal = pairs[i].split('=');
                    params[nameVal[0]] = nameVal[1];
                }
            }
            return params;
        }
        function init(){
            params = getParams();
            inday = document.getElementById("date")
            inhour = document.getElementById("hour")
            inzone = document.getElementById("zone")
            if (params["date"]!=""){
                inday.value = params["date"]
            }
            if (params["time"]!=""){
                inhour.value =  decodeURIComponent(params["time"])
            }
            if (params["zone"]!=""){
                inzone.value =  decodeURIComponent(params["zone"])
            }
            if (params["refresh"]!=undefined){
                setInterval(update,1000)
            }
            update()
        }
        function refreshUrl(){
            inday = document.getElementById("date")
            inhour = document.getElementById("hour")
            inzone = document.getElementById("zone")
            start = new Date(Date.parse(inday.value+"T"+inhour.value+"-"+inzone.value))
            yr = start.getFullYear()
            mo = (start.getMonth()+1).toString().padStart(2, '0')
            dy = start.getDate().toString().padStart(2, '0')
            hr = start.getHours().toString().padStart(2, '0')
            mi = start.getMinutes().toString().padStart(2, '0')
            zo = start.getTimezoneOffset()
            zm = zo % 60
            zh = (zo - zm)/60
            zh = zh.toString().padStart(2, '0')
            zm = zm.toString().padStart(2, '0')

            pdate = yr+'-'+mo+'-'+dy
            ptime = hr+':'+mi
            pzone = zh+':'+zm
            var href = new URL(window.location.href)
            href.searchParams.set("date", pdate)
            href.searchParams.set("time", ptime)
            href.searchParams.set("zone", pzone)

            share = document.getElementById("share")
            share.href = href
            /*window.location.search = searchParams.toString()*/
        }
        function update(){
            inday = document.getElementById("date")
            inhour = document.getElementById("hour")
            inzone = document.getElementById("zone")
            curr = document.getElementById("current")

            bday = document.getElementById("bdate")
            bhour = document.getElementById("bhour")
            pending = document.getElementById("pending")
            future = document.getElementById("future")

            today = new Date()
            start = new Date(Date.parse(inday.value+"T"+inhour.value+"-"+inzone.value))
            diff = (today - start)
            secs = Math.round(diff/1000)
            curr.value=secs.toLocaleString()
            if (secs > 1000000000){
                secs = secs % 1000000000
                secs = secs
            }
            if (params["adj"]!=undefined){
                secs = secs + 3600
            }
            togo = 1000000000 - secs
            secs = today.getSeconds() + togo
            today.setSeconds(secs);
            diff = (today - start)
            secs = Math.round(diff/1000)
            bdate.value = today.toISOString().substring(0,10)
            bhour.value = today.toISOString().substring(11,16)
            future.value=secs.toLocaleString()
            pending.value=togo.toLocaleString()
            refreshUrl()
        }
    </script>
</header>
<body onload="init();">

<h1>Happy billion birth-second !!! </h1>
Your were born on <input type="date" id="date" onchange="update()"/> at <input type="time" step="1" id="hour" onchange="update()"/> UTC <input type="time" id="zone" onchange="update()"/><p/>
You are now <input type="text" id="current" readonly> seconds old.<p/>
Your next billion birth-second is comming up in only <input type="text" id="pending" readonly> seconds !<p/>
You will be  <input type="text" id="future" readonly> seconds old on <input type="date" id="bdate" readonly/> at <input type="time" step="1" id="bhour" readonly/>
<p/><p/>
Have a happy billion birth-second !!!<p/>
<div class="fb-share-button" data-layout="button" data-size="small">
<a id="share" onclick="refreshUrl()" target="_blank" class="fb-xfbml-parse-ignore">Share</a>
</div>
</body>
</html>